<div id="invoice-content" class="p-4 bg-dark text-light rounded">
    <div class="text-center mb-4">
        <h3 class="text-pink">فاتورة الطلب</h3>
        <hr class="bg-pink" />
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <strong>Order Id:</strong> @Model.OrderId<br />
            <strong>Date:</strong> @Model.CreatedAt.ToShortDateString()<br />
            <strong>OrderFor:</strong> @Model.OrderFor
        </div>
        <div class="col-md-6 text-end">
            <strong>Total Amount:</strong> @Model.TotalAmount.ToString("C")<br />
            <strong>Payment Method:</strong> @Model.Payment?.PaymentMethod
        </div>
    </div>

    <table class="table table-bordered table-striped text-light">
        <thead class="bg-pink text-dark">
            <tr>
                <th>Product</th>
                <th>Quantity</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderItems)
            {
                <tr>
                    <td><img src="@item.ImageURL" alt="Product" /></td>
                    <td>@item.Quantity</td>
                    @* أضف السعر هنا إذا متوفر *@
                </tr>
            }
        </tbody>
    </table>

    <div class="text-center mt-4" style="display: flex; justify-content: center; gap: 10px;">
        <button class="btn btn-pink" onclick="printInvoice()">🖨️ طباعة</button>
        <button class="btn btn-pink" onclick="downloadPDF()">📥 تحميل PDF</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
    function printInvoice() {
        const invoiceContent = document.getElementById('invoice-content').innerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>فاتورة الطلب</title>
                    <style>
                        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: white; color: black; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
                        th { background-color: #f8b6c1; color: black; }
                        h3 { color: #f06292; }
                    </style>
                </head>
                <body onload="window.print(); window.close();">
                    ${invoiceContent}
                </body>
            </html>
        `);
        printWindow.document.close();
    }

    function downloadPDF() {
        const element = document.getElementById('invoice-content');
        if (!element) {
            alert('لم يتم تحميل الفاتورة بعد.');
            return;
        }

        const opt = {
            margin: 0.3,
            filename: `فاتورة_طلب_${@Model.OrderId}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save();
    }
</script>
